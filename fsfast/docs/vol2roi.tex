% $Id: vol2roi.tex,v 1.1 2005/05/04 17:00:49 greve Exp $
\documentclass[10pt]{article}
\usepackage{amsmath}
%\usepackage{draftcopy}

%%%%%%%%%% set margins %%%%%%%%%%%%%
\addtolength{\textwidth}{1in}
\addtolength{\oddsidemargin}{-0.5in}
\addtolength{\textheight}{.75in}
\addtolength{\topmargin}{-.50in}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%% begin document %%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

\begin{Large}
\noindent {\bf vol2roi} \\
\end{Large}

\noindent 
\begin{verbatim}
Comments or questions: analysis-bugs@nmr.mgh.harvard.edu\\
$Id: vol2roi.tex,v 1.1 2005/05/04 17:00:49 greve Exp $
\end{verbatim}

\section{Introduction}

{\bf vol2roi} is a program for combining a set of voxels from a volume
into one average (possibly one for each frame). The set is specified
in one of 3 ways: (1) volume mask, (2) label file, or (3) both.The
volume mask is a volume of values. The user specifies the sign and
threshold above which a voxel in the volume mask can be considered for
inclusion. The user can also specify the frame in the mask volume to
use in creating the mask.  The field-of-view (FOV) of the volume mask
does not need to coincide with that of the source volume; if it does
not, then the user must specify a registration matrix.  The label file
is a set of XYZ coordinates and is typically generated by either
tkmedit or tksurfer.  If both label and mask volume are specified, then
only those voxels that are in the intersection of the label and mask
are included.  The software automatically detects whether the input
volume is an output of selxavg and, if so, automatically converts
standard deviations into variances for averaging.\\

\section{Usage}
Typing vol2roi at the command-line without any options will give the
following message:\\ 

\begin{small}
\begin{verbatim}
USAGE: vol2roi
   --roifile   output path 

   --srcvol    input volume path 
   --srcfmt    input volume format 
   --srcreg    source registration (SrcXYZ = R*AnatXYZ) 
   --srcoldreg interpret srcreg as old-style reg.dat 
   --srcwarp   source scanner warp table

   --label     path to label file 
   --labelreg  label registration (LabelXYZ = L*AnatXYZ) 

   --mskvol     mask volume path 
   --mskfmt     mask volume format 
   --mskreg     mask registration  (MaskXYZ = M*AnatXYZ)
   --msksamesrc mask volume has same FOV as source 

   --mskthresh threshold (0.5) mask threshold
   --msktail   <abs>, pos, or neg (mask tail) 
   --mskframe  0-based mask frame <0> 

   --finalmskvol path in which to save final mask

   --float2int float-to-int conversion method (<round>, floor, or tkreg )
\end{verbatim}
\end{small}

\section{Command-line Arguments}

\noindent
{\bf --roiavg roistem}: stem of the output roi file. The file will have the
name ``roistem\_000.bfloat''. The ROI average is stored in {\em bfile
format}.\\ 

\noindent
{\bf --srcvol}: path of the volume from which to obtain the data to
average. \\

\noindent
{\bf --srcreg}: file with registration information.  The registration
matrix will convert XYZ coordinates in the subject's anatomical space
to XYZ in the scanner space of the source volume.  If no --srcreg file
is specified, the matrix is assumed to be the identity. With the
--srcoldreg flag, the registration matrix is interpreted to convert
XYZ coordinates in the subject's anatomical space to XYZ in the FOV
space of the source volume.\\

\noindent
{\bf --srcoldreg}: flag to indicate that --srcreg is an old-style
registration matrix.\\

\noindent
{\bf --srcwarp}: scanner warp file of the source volume.  The warp
file converts from scanner coordinates to warped scanner coordinates.\\

\noindent
{\bf --label}: file with label coordinates stored in label-file format.\\

\noindent
{\bf --labelreg}: file with label registration information.  The
registration matrix will convert XYZ coordinates in the label space to
XYZ in the anatomical subject's space.  If not specified, the matrix
is assumed to be the identity. For example, if the label was
specified in talairach space, then the talairach.xfm file should be
specified. \\

\noindent
{\bf --mskvol}: path of the volume from which to obtain a mask.\\

\noindent
{\bf --mskreg}: file with mask registration information.  The
registration matrix will convert XYZ coordinates in the subject's
anatomical space to XYZ in the space of the mask volume.  If no
--mskreg file is specified, the matrix is assumed to be the
identity. For example, if the mask was specified in talairach space,
then the talairach.xfm file should be specified. If the --msksamesrc
flag is included, then the mask volume is assumed to have a
voxel-by-voxel correspondence with the source volume.\\

\noindent
{\bf --msksamesrc}: flag to indicate that mask volume has a
voxel-by-voxel correspondence with the source volume.\\

\noindent
{\bf --mskthresh}: threshold with which to choose which voxels in the
mask volume should be included. Only those voxels that exceed the
threshold can be considered for inclusion in the ROI. See also
--msktail.  Default: 0.5.\\

\noindent
{\bf --msktail}: this is used to specify whether include only positive or only
negative or both types of voxels from the mask volume.  Allowable
values are: absolute, positive, and negative (or just the first 3
letters of each). Default: absolute.\\

\noindent
{\bf --mskframe}: specifies the frame inside the mask volume to use
when creating the mask.  The frame number is zero-based. Default: 0.\\

\noindent
{\bf --finalmskvol}: save the final masking volume in the specified
location. This volume has a voxel-by-voxel correspondence with the
source volume.  It has a 1 at each voxel included in the final ROI
average and a zero everywhere else.\\



\section{Examples}

\subsection{Mask Volume Only (same FOV as Source)}

If the name of the source volume is ``fsrc'', and the name  of the
mask volume is ``allvfix''.  The user want to use those voxels in the
third frame of the mask volume that are positive and exceed a value of
5. The command line would be:
\begin{verbatim}
vol2roi --roiavg avfroi
        --srcvol fsrc 
        --mskvol allvfix --msksamesrc 
        --msktail positive --mskthresh 5 --mskframe 2
\end{verbatim}
This will create a file called ``avfroi\_000.bfloat''. Note that
``--mskframe 2'' is used to specify the third frame because --mskframe
is expecting the frame number to be zero-based.\\

\subsection{Mask Volume Only (different FOV than source)}

Consider the case where a group of data has been averaged in talariach
space the results of which are going to be used to create ROIs back in
the original functional space of each subject.  The mask volume is
specified in talairach space and has a different FOV than the original
functionals. Two registrations need to be specified in this case: the
source registration and the mask registration.  The source
registration converts XYZ coordinates in the individual's anatomical
space to XYZ coordinates in the functional space.  The mask
registration converts XYZ coordinates in the mask's FOV space to
XYZ coordinates in the individual's anatomical.  When the two are
concatenated, the result is the registration between the mask and the
functional. 

Let the name of the source volume be ``fsrc'' and the name of the mask
volume be ``talallvfix''.  Assume the source registration file to be
register.dat and the mask registration file to be talariach.xfm.  The
user want to use all voxels in the first frame of the mask volume that
exceed a value of 7 (regardless of sign). The command line would be:
\begin{verbatim}
vol2roi --roiavg tal_avf_roi
        --srcvol fsrc 
        --srcreg register.dat 
        --mskvol allvfix --mskreg talairach.xfm
        --mskthresh 7 --msktail absolute
\end{verbatim}
This will create a file called ``tal\_avf\_roi\_000.bfloat''.  Note that
``--mskframe 0'' is not specified explicitly because 0 is the
default. Also note that ``--msktail absolute'' instructs vol2roi to
ignore the mask sign; this could have been excluded because vol2roi
uses ``abolute'' by default.\\

\subsection{Label Only (Label Coords in Subject's Anatomical Space)}

Let the name of the source volume be ``fsrc'' and the name of the
label file be ``hippo.label''.  Assume the source registration file is
named ``register.dat''. The user want to average the voxels
corresponding to the coordinates in the label. These coordinates are
in the subject's anatomical space. The command line would be:
\begin{verbatim}
vol2roi --roiavg src_hippo
        --srcvol fsrc 
        --srcreg register.dat 
        --label hippo.label
\end{verbatim}
This will create a file called ``src\_hippo\_000.bfloat''.

\subsection{Label Only (Label Coords NOT in Subject's Anatomical Space)}

Let the name of the source volume be ``fsrc'' and the name of the
label file be ``hippo.label''.  Assume the source registration file is
named ``register.dat''. The user want to average the voxels
corresponding to the coordinates in the label. These coordinates are
in some space other than the subject's anatomical. For example, the
label could be in talairach space, and the label registration could be
talairach.xfm. The command line would be:
\begin{verbatim}
vol2roi --roiavg src_tal_hippo
        --srcvol fsrc 
        --srcreg register.dat 
        --label  hippo.label
        --labelreg talairach.xfm
\end{verbatim}
This will create a file called ``src\_tal\_hippo\_000.bfloat''.\\

\subsection{Label and Mask}

Let the name of the source volume be ``fsrc'' and the name of the
label file be ``hippo.label''.  Assume the source registration file is
named ``register.dat''. The user want to average the voxels
corresponding to the coordinates in the label. These coordinates are
in some space other than the subject's anatomical. For example, the
label could be in talairach space, and the label registration could be
talairach.xfm. There is also a mask called ``talavf,'' also in
talairach space.
\begin{verbatim}
vol2roi --roiavg src_tal_hippo_msk
        --srcvol fsrc 
        --srcreg register.dat 
        --label  hippo.label
        --labelreg talairach.xfm
        --mskvol talavf --mskreg talairach.xfm
        --finalmsk mask_tal_hippo
\end{verbatim}
This will create a file called
``src\_tal\_hippo\_msk\_000.bfloat''. It will also create a volume
called ``mask\_tal\_hippo.'' This volume will have a voxel-by-voxel
correspondence with the source volume, and the values in this volume
will be 1 if that voxel was included in the ROI or 0 if it was excluded.


\end{document}


